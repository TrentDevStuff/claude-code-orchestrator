
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Complete API documentation for Claude Code with agentic capabilities">
      
      
        <meta name="author" content="Anthropic">
      
      
      
      
      
        
      
      
      <link rel="icon" href="data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><text y="75" font-size="75" fill="%23000">C</text></svg>">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>Architecture - Claude Code API Service - Claude Code API Documentation</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../css/extra.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-XXXXXXXXXX"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-XXXXXXXXXX",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-XXXXXXXXXX",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script>
  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#architecture-claude-code-api-service" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Claude Code API Documentation" class="md-header__button md-logo" aria-label="Claude Code API Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Claude Code API Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Architecture - Claude Code API Service
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/anthropics/claude-code-api" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    anthropics/claude-code-api
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href=".." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../quickstart/" class="md-tabs__link">
        
  
  
    
  
  Quick Start

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../api-reference/completions/" class="md-tabs__link">
          
  
  
  API Reference

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../guides/getting-started/" class="md-tabs__link">
          
  
  
  Guides

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../examples/code-analysis/" class="md-tabs__link">
          
  
  
  Examples

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../deployment/docker-compose/" class="md-tabs__link">
          
  
  
  Deployment

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../client-libraries/python/" class="md-tabs__link">
          
  
  
  Client Libraries

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Claude Code API Documentation" class="md-nav__button md-logo" aria-label="Claude Code API Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Claude Code API Documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/anthropics/claude-code-api" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    anthropics/claude-code-api
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../quickstart/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Quick Start
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    API Reference
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    API Reference
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api-reference/completions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Completions
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api-reference/agentic-tasks/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Agentic Tasks
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api-reference/websocket/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    WebSocket Streaming
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api-reference/authentication/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Authentication
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Guides
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Guides
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../guides/getting-started/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Getting Started
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../guides/agentic-api-guide/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Agentic API
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../guides/security-best-practices/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Security Best Practices
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../guides/permission-model/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Permission Model
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../guides/error-handling/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Error Handling
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Examples
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Examples
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/code-analysis/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Code Analysis
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/documentation-generation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Documentation Generation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/test-generation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Test Generation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/multi-agent-workflow/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Multi-Agent Workflows
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Deployment
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Deployment
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../deployment/docker-compose/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Docker Compose
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../deployment/production/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Production
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../deployment/monitoring/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Monitoring
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Client Libraries
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    Client Libraries
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../client-libraries/python/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Python
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#system-overview" class="md-nav__link">
    <span class="md-ellipsis">
      
        System Overview
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#core-components" class="md-nav__link">
    <span class="md-ellipsis">
      
        Core Components
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Core Components">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-fastapi-server-mainpy" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. FastAPI Server (main.py)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-api-router-srcapipy" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. API Router (src/api.py)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-worker-pool-srcworker_poolpy" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. Worker Pool (src/worker_pool.py)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-model-router-srcmodel_routerpy" class="md-nav__link">
    <span class="md-ellipsis">
      
        4. Model Router (src/model_router.py)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-budget-manager-srcbudget_managerpy" class="md-nav__link">
    <span class="md-ellipsis">
      
        5. Budget Manager (src/budget_manager.py)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6-token-tracker-srctoken_trackerpy" class="md-nav__link">
    <span class="md-ellipsis">
      
        6. Token Tracker (src/token_tracker.py)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7-cache-layer-srccachepy" class="md-nav__link">
    <span class="md-ellipsis">
      
        7. Cache Layer (src/cache.py)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data-flow" class="md-nav__link">
    <span class="md-ellipsis">
      
        Data Flow
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Data Flow">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chat-completion-request" class="md-nav__link">
    <span class="md-ellipsis">
      
        Chat Completion Request
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#batch-processing-request" class="md-nav__link">
    <span class="md-ellipsis">
      
        Batch Processing Request
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#concurrency-model" class="md-nav__link">
    <span class="md-ellipsis">
      
        Concurrency Model
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Concurrency Model">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#thread-safety" class="md-nav__link">
    <span class="md-ellipsis">
      
        Thread Safety
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#asyncawait-fastapi" class="md-nav__link">
    <span class="md-ellipsis">
      
        Async/Await (FastAPI)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#process-isolation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Process Isolation
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#scalability" class="md-nav__link">
    <span class="md-ellipsis">
      
        Scalability
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Scalability">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#horizontal-scaling" class="md-nav__link">
    <span class="md-ellipsis">
      
        Horizontal Scaling
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vertical-scaling" class="md-nav__link">
    <span class="md-ellipsis">
      
        Vertical Scaling
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#security" class="md-nav__link">
    <span class="md-ellipsis">
      
        Security
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Security">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#threat-model" class="md-nav__link">
    <span class="md-ellipsis">
      
        Threat Model
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#data-privacy" class="md-nav__link">
    <span class="md-ellipsis">
      
        Data Privacy
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#performance" class="md-nav__link">
    <span class="md-ellipsis">
      
        Performance
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Performance">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#latency-breakdown" class="md-nav__link">
    <span class="md-ellipsis">
      
        Latency Breakdown
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#throughput" class="md-nav__link">
    <span class="md-ellipsis">
      
        Throughput
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#error-handling" class="md-nav__link">
    <span class="md-ellipsis">
      
        Error Handling
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Error Handling">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#error-propagation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Error Propagation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#retry-strategy" class="md-nav__link">
    <span class="md-ellipsis">
      
        Retry Strategy
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing" class="md-nav__link">
    <span class="md-ellipsis">
      
        Testing
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Testing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#test-coverage" class="md-nav__link">
    <span class="md-ellipsis">
      
        Test Coverage
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#integration-tests" class="md-nav__link">
    <span class="md-ellipsis">
      
        Integration Tests
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#future-enhancements" class="md-nav__link">
    <span class="md-ellipsis">
      
        Future Enhancements
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#diagrams" class="md-nav__link">
    <span class="md-ellipsis">
      
        Diagrams
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="architecture-claude-code-api-service">Architecture - Claude Code API Service<a class="headerlink" href="#architecture-claude-code-api-service" title="Permanent link">&para;</a></h1>
<p>System architecture and component design documentation.</p>
<h2 id="system-overview">System Overview<a class="headerlink" href="#system-overview" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code>┌──────────────────────────────────────────────────────────────────┐
│                         Client Applications                       │
│  (Web Apps, Mobile Apps, Scripts, Services)                      │
└────────────────────────────┬─────────────────────────────────────┘
                             │
                             │ HTTP/REST
                             │
┌────────────────────────────▼─────────────────────────────────────┐
│                      FastAPI Server (main.py)                     │
│  ┌────────────────────────────────────────────────────────────┐ │
│  │ API Router (src/api.py)                                    │ │
│  │  • POST /v1/chat/completions                               │ │
│  │  • POST /v1/batch                                          │ │
│  │  • GET  /v1/usage                                          │ │
│  │  • POST /v1/route                                          │ │
│  └────────────────────────────────────────────────────────────┘ │
└──┬────────────────┬──────────────────┬─────────────────────────┬─┘
   │                │                  │                         │
   │                │                  │                         │
   ▼                ▼                  ▼                         ▼
┌─────────────┐ ┌──────────────┐ ┌──────────────┐  ┌──────────────────┐
│ Worker Pool │ │ Model Router │ │Budget Manager│  │   Token Tracker  │
│(worker_pool │ │(model_router │ │(budget_mgr   │  │(token_tracker.py)│
│     .py)    │ │     .py)     │ │   .py)       │  │                  │
└──────┬──────┘ └──────────────┘ └──────┬───────┘  └──────────────────┘
       │                                  │
       │                                  │
       ▼                                  ▼
┌────────────────────┐           ┌────────────────┐
│  Claude CLI Procs  │           │ SQLite Database│
│  (subprocess)      │           │ (budgets.db)   │
│  • haiku workers   │           │ • Projects     │
│  • sonnet workers  │           │ • Usage logs   │
│  • opus workers    │           │ • Budgets      │
└────────────────────┘           └────────────────┘
         │
         ▼
┌────────────────────┐
│   Redis Cache      │
│  (optional)        │
│  • Prompt caching  │
│  • Rate limiting   │
└────────────────────┘
</code></pre></div>
<h2 id="core-components">Core Components<a class="headerlink" href="#core-components" title="Permanent link">&para;</a></h2>
<h3 id="1-fastapi-server-mainpy">1. FastAPI Server (<code>main.py</code>)<a class="headerlink" href="#1-fastapi-server-mainpy" title="Permanent link">&para;</a></h3>
<p><strong>Purpose:</strong> HTTP server and application orchestrator</p>
<p><strong>Responsibilities:</strong>
- Serve REST API endpoints
- Manage application lifecycle (startup/shutdown)
- Initialize and coordinate services
- Handle CORS, middleware</p>
<p><strong>Key Code:</strong>
<div class="highlight"><pre><span></span><code><span class="nd">@asynccontextmanager</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">lifespan</span><span class="p">(</span><span class="n">app</span><span class="p">:</span> <span class="n">FastAPI</span><span class="p">):</span>
    <span class="c1"># Startup</span>
    <span class="n">worker_pool</span> <span class="o">=</span> <span class="n">WorkerPool</span><span class="p">(</span><span class="n">max_workers</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">budget_manager</span> <span class="o">=</span> <span class="n">BudgetManager</span><span class="p">(</span><span class="n">db_path</span><span class="o">=</span><span class="s2">&quot;data/budgets.db&quot;</span><span class="p">)</span>

    <span class="n">worker_pool</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
    <span class="n">initialize_services</span><span class="p">(</span><span class="n">worker_pool</span><span class="p">,</span> <span class="n">budget_manager</span><span class="p">)</span>

    <span class="k">yield</span>

    <span class="c1"># Shutdown</span>
    <span class="n">worker_pool</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
</code></pre></div></p>
<p><strong>Configuration:</strong>
- Port: 8080 (default)
- CORS: Enabled for all origins (configurable)
- Timeout: 30s default per request</p>
<h3 id="2-api-router-srcapipy">2. API Router (<code>src/api.py</code>)<a class="headerlink" href="#2-api-router-srcapipy" title="Permanent link">&para;</a></h3>
<p><strong>Purpose:</strong> REST API endpoint definitions</p>
<p><strong>Endpoints:</strong>
| Endpoint | Method | Purpose |
|----------|--------|---------|
| <code>/v1/chat/completions</code> | POST | Single completion request |
| <code>/v1/batch</code> | POST | Parallel batch processing |
| <code>/v1/usage</code> | GET | Usage statistics |
| <code>/v1/route</code> | POST | Model routing recommendation |
| <code>/health</code> | GET | Health check |
| <code>/</code> | GET | API information |</p>
<p><strong>Flow for <code>/v1/chat/completions</code>:</strong>
<div class="highlight"><pre><span></span><code>1. Receive request → Validate with Pydantic
2. Auto-select model (if not specified) → model_router.py
3. Check budget → budget_manager.py
4. Submit to worker pool → worker_pool.py
5. Wait for completion
6. Track usage → budget_manager.py
7. Return response
</code></pre></div></p>
<p><strong>Error Handling:</strong>
- <code>400</code> - Invalid request
- <code>429</code> - Budget exceeded
- <code>500</code> - Task failed or service error</p>
<h3 id="3-worker-pool-srcworker_poolpy">3. Worker Pool (<code>src/worker_pool.py</code>)<a class="headerlink" href="#3-worker-pool-srcworker_poolpy" title="Permanent link">&para;</a></h3>
<p><strong>Purpose:</strong> Manage concurrent Claude CLI processes</p>
<p><strong>Architecture:</strong>
<div class="highlight"><pre><span></span><code>WorkerPool
├── Task Queue (FIFO)
├── Active Workers (dict)
├── Monitor Thread (background)
└── Task Results (dict)
</code></pre></div></p>
<p><strong>Features:</strong>
- <strong>Max workers:</strong> Configurable limit (default: 5)
- <strong>Task queue:</strong> Overflow requests queued
- <strong>Timeout handling:</strong> Automatic cleanup after timeout
- <strong>PID tracking:</strong> Monitor active processes
- <strong>Cost calculation:</strong> Automatic based on token usage</p>
<p><strong>Lifecycle:</strong>
<div class="highlight"><pre><span></span><code>1. submit(prompt, model) → Generate task_id
2. Queue task
3. Monitor thread picks up task
4. Start Claude CLI subprocess
5. Wait for completion
6. Parse JSON output
7. Calculate cost
8. Store result
9. Cleanup temp files
</code></pre></div></p>
<p><strong>Cost Calculation (January 2026 pricing):</strong>
<div class="highlight"><pre><span></span><code><span class="n">COST_PER_MTK</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;haiku&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;input&quot;</span><span class="p">:</span> <span class="mf">0.25</span><span class="p">,</span> <span class="s2">&quot;output&quot;</span><span class="p">:</span> <span class="mf">1.25</span><span class="p">},</span>
    <span class="s2">&quot;sonnet&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;input&quot;</span><span class="p">:</span> <span class="mf">3.00</span><span class="p">,</span> <span class="s2">&quot;output&quot;</span><span class="p">:</span> <span class="mf">15.00</span><span class="p">},</span>
    <span class="s2">&quot;opus&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;input&quot;</span><span class="p">:</span> <span class="mf">15.00</span><span class="p">,</span> <span class="s2">&quot;output&quot;</span><span class="p">:</span> <span class="mf">75.00</span><span class="p">},</span>
<span class="p">}</span>

<span class="n">cost</span> <span class="o">=</span> <span class="p">(</span><span class="n">input_tokens</span> <span class="o">/</span> <span class="mi">1_000_000</span><span class="p">)</span> <span class="o">*</span> <span class="n">input_rate</span> <span class="o">+</span> \
       <span class="p">(</span><span class="n">output_tokens</span> <span class="o">/</span> <span class="mi">1_000_000</span><span class="p">)</span> <span class="o">*</span> <span class="n">output_rate</span>
</code></pre></div></p>
<h3 id="4-model-router-srcmodel_routerpy">4. Model Router (<code>src/model_router.py</code>)<a class="headerlink" href="#4-model-router-srcmodel_routerpy" title="Permanent link">&para;</a></h3>
<p><strong>Purpose:</strong> Intelligent model selection based on task complexity</p>
<p><strong>Routing Logic:</strong>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">auto_select_model</span><span class="p">(</span><span class="n">prompt</span><span class="p">,</span> <span class="n">context_size</span><span class="p">,</span> <span class="n">budget_remaining</span><span class="p">):</span>
    <span class="c1"># 1. Budget constraint</span>
    <span class="k">if</span> <span class="n">budget_remaining</span> <span class="o">&lt;</span> <span class="mi">1000</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;haiku&quot;</span>

    <span class="c1"># 2. Context constraint</span>
    <span class="k">if</span> <span class="n">context_size</span> <span class="o">&gt;</span> <span class="mi">10000</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;opus&quot;</span>

    <span class="c1"># 3. Complexity analysis</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">prompt</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">100</span> <span class="ow">and</span> <span class="n">has_simple_keywords</span><span class="p">(</span><span class="n">prompt</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;haiku&quot;</span>

    <span class="k">if</span> <span class="n">has_complex_keywords</span><span class="p">(</span><span class="n">prompt</span><span class="p">)</span> <span class="ow">and</span> <span class="n">budget_remaining</span> <span class="o">&gt;=</span> <span class="mi">5000</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;sonnet&quot;</span>

    <span class="c1"># 4. Default</span>
    <span class="k">return</span> <span class="s2">&quot;sonnet&quot;</span>
</code></pre></div></p>
<p><strong>Keywords:</strong>
- <strong>Simple:</strong> list, format, count, show, get, create, add
- <strong>Complex:</strong> analyze, architect, debug, design, implement, optimize</p>
<p><strong>Example Routing:</strong>
| Prompt | Context | Budget | Selected Model |
|--------|---------|--------|---------------|
| "List Python files" | 50 | 100k | Haiku |
| "Analyze codebase" | 5k | 100k | Sonnet |
| "Review 50k lines" | 15k | 100k | Opus |
| "Simple task" | 100 | 500 | Haiku (budget) |</p>
<h3 id="5-budget-manager-srcbudget_managerpy">5. Budget Manager (<code>src/budget_manager.py</code>)<a class="headerlink" href="#5-budget-manager-srcbudget_managerpy" title="Permanent link">&para;</a></h3>
<p><strong>Purpose:</strong> Per-project budget tracking and enforcement</p>
<p><strong>Database Schema:</strong>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">projects</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="n">id</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span>
<span class="w">    </span><span class="n">name</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">    </span><span class="n">monthly_token_limit</span><span class="w"> </span><span class="nb">INTEGER</span><span class="p">,</span>
<span class="w">    </span><span class="n">created_at</span><span class="w"> </span><span class="k">TIMESTAMP</span>
<span class="p">);</span>

<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">usage_log</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="n">id</span><span class="w"> </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="n">AUTOINCREMENT</span><span class="p">,</span>
<span class="w">    </span><span class="n">project_id</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">model</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">tokens</span><span class="w"> </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">cost_usd</span><span class="w"> </span><span class="nb">REAL</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="k">timestamp</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">CURRENT_TIMESTAMP</span><span class="p">,</span>
<span class="w">    </span><span class="k">FOREIGN</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">project_id</span><span class="p">)</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">projects</span><span class="p">(</span><span class="n">id</span><span class="p">)</span>
<span class="p">);</span>

<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_usage_project_timestamp</span>
<span class="k">ON</span><span class="w"> </span><span class="n">usage_log</span><span class="p">(</span><span class="n">project_id</span><span class="p">,</span><span class="w"> </span><span class="k">timestamp</span><span class="p">);</span>
</code></pre></div></p>
<p><strong>Operations:</strong>
- <code>check_budget(project_id, estimated_tokens)</code> → bool
- <code>track_usage(project_id, model, tokens, cost)</code> → void
- <code>get_usage(project_id, period)</code> → stats
- <code>set_budget(project_id, monthly_limit)</code> → void</p>
<p><strong>Budget Enforcement:</strong>
<div class="highlight"><pre><span></span><code>1. Check current month usage
2. Estimate request tokens
3. Verify: current + estimated &lt;= limit
4. If exceeds → Return 429
5. If passes → Allow request
6. After completion → Track actual usage
</code></pre></div></p>
<h3 id="6-token-tracker-srctoken_trackerpy">6. Token Tracker (<code>src/token_tracker.py</code>)<a class="headerlink" href="#6-token-tracker-srctoken_trackerpy" title="Permanent link">&para;</a></h3>
<p><strong>Purpose:</strong> Parse Claude CLI output and calculate costs</p>
<p><strong>Parsing Flow:</strong>
<div class="highlight"><pre><span></span><code>1. Receive JSON string from Claude CLI
2. Extract usage: { input_tokens, output_tokens }
3. Extract model name
4. Determine model tier (haiku/sonnet/opus)
5. Calculate cost: (tokens / 1000) * rate_per_1k
6. Return structured data
</code></pre></div></p>
<p><strong>Example Output:</strong>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
    <span class="s2">&quot;input_tokens&quot;</span><span class="p">:</span> <span class="mi">150</span><span class="p">,</span>
    <span class="s2">&quot;output_tokens&quot;</span><span class="p">:</span> <span class="mi">300</span><span class="p">,</span>
    <span class="s2">&quot;total_tokens&quot;</span><span class="p">:</span> <span class="mi">450</span><span class="p">,</span>
    <span class="s2">&quot;model&quot;</span><span class="p">:</span> <span class="s2">&quot;claude-3-sonnet-20240229&quot;</span><span class="p">,</span>
    <span class="s2">&quot;model_tier&quot;</span><span class="p">:</span> <span class="s2">&quot;sonnet&quot;</span><span class="p">,</span>
    <span class="s2">&quot;cost_usd&quot;</span><span class="p">:</span> <span class="mf">0.005850</span>
<span class="p">}</span>
</code></pre></div></p>
<h3 id="7-cache-layer-srccachepy">7. Cache Layer (<code>src/cache.py</code>)<a class="headerlink" href="#7-cache-layer-srccachepy" title="Permanent link">&para;</a></h3>
<p><strong>Purpose:</strong> Redis-based caching for performance</p>
<p><strong>Cached Data:</strong>
- Frequent prompts → completions
- Usage statistics → aggregated stats
- Rate limit counters → request counts</p>
<p><strong>Cache Strategy:</strong>
- <strong>TTL:</strong> 1 hour for completions
- <strong>Invalidation:</strong> On budget changes
- <strong>Key format:</strong> <code>prompt:{hash}</code>, <code>usage:{project_id}:{period}</code></p>
<h2 id="data-flow">Data Flow<a class="headerlink" href="#data-flow" title="Permanent link">&para;</a></h2>
<h3 id="chat-completion-request">Chat Completion Request<a class="headerlink" href="#chat-completion-request" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>Client
  │
  │ POST /v1/chat/completions
  │ { messages, model?, project_id }
  ▼
API Router (src/api.py)
  │
  │ Validate request (Pydantic)
  ▼
Model Router (if model not specified)
  │
  │ auto_select_model(prompt, context, budget)
  ▼
Budget Manager
  │
  │ check_budget(project_id, estimated_tokens)
  ▼
Worker Pool
  │
  │ submit(prompt, model, project_id)
  │ → task_id
  ▼
Monitor Thread
  │
  │ Start Claude CLI subprocess
  │ claude -p &quot;prompt&quot; --model sonnet --output-format json
  ▼
Claude CLI Process
  │
  │ Generate completion
  │ Return JSON with usage stats
  ▼
Worker Pool
  │
  │ Parse JSON (token_tracker)
  │ Calculate cost
  │ Store result
  ▼
API Router
  │
  │ track_usage(project_id, tokens, cost)
  │ Format response
  ▼
Client
  │
  │ { id, model, content, usage, cost }
</code></pre></div>
<h3 id="batch-processing-request">Batch Processing Request<a class="headerlink" href="#batch-processing-request" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>Client
  │
  │ POST /v1/batch
  │ { prompts: [...], model?, project_id }
  ▼
API Router
  │
  │ For each prompt:
  │   submit to worker pool → task_ids[]
  ▼
Worker Pool
  │
  │ Process all in parallel (up to max_workers)
  ▼
Aggregate Results
  │
  │ Collect all task results
  │ Calculate total cost, total tokens
  │ Track usage for each
  ▼
Client
  │
  │ { total, completed, failed, results, total_cost }
</code></pre></div>
<h2 id="concurrency-model">Concurrency Model<a class="headerlink" href="#concurrency-model" title="Permanent link">&para;</a></h2>
<h3 id="thread-safety">Thread Safety<a class="headerlink" href="#thread-safety" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Worker Pool</span>
<span class="k">class</span><span class="w"> </span><span class="nc">WorkerPool</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lock</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Lock</span><span class="p">()</span>  <span class="c1"># Protects shared state</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tasks</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Task</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">task_queue</span><span class="p">:</span> <span class="n">Queue</span> <span class="o">=</span> <span class="n">Queue</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">monitor_thread</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_monitor_loop</span><span class="p">)</span>
</code></pre></div>
<p><strong>Protected Operations:</strong>
- Task submission
- Task status updates
- Worker count changes
- Process cleanup</p>
<h3 id="asyncawait-fastapi">Async/Await (FastAPI)<a class="headerlink" href="#asyncawait-fastapi" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># API endpoints run in async context</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">chat_completion</span><span class="p">(</span><span class="n">request</span><span class="p">:</span> <span class="n">ChatCompletionRequest</span><span class="p">):</span>
    <span class="c1"># Submit task (sync operation)</span>
    <span class="n">task_id</span> <span class="o">=</span> <span class="n">worker_pool</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>

    <span class="c1"># Wait for result (blocking → async wrapper)</span>
    <span class="n">loop</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">get_event_loop</span><span class="p">()</span>
    <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">loop</span><span class="o">.</span><span class="n">run_in_executor</span><span class="p">(</span>
        <span class="kc">None</span><span class="p">,</span>
        <span class="n">worker_pool</span><span class="o">.</span><span class="n">get_result</span><span class="p">,</span>
        <span class="n">task_id</span>
    <span class="p">)</span>
</code></pre></div>
<h3 id="process-isolation">Process Isolation<a class="headerlink" href="#process-isolation" title="Permanent link">&para;</a></h3>
<p>Each Claude CLI invocation runs in a separate process:
- <strong>Isolation:</strong> Tasks don't interfere
- <strong>Cleanup:</strong> Process death = automatic cleanup
- <strong>Monitoring:</strong> PID tracking for all workers</p>
<h2 id="scalability">Scalability<a class="headerlink" href="#scalability" title="Permanent link">&para;</a></h2>
<h3 id="horizontal-scaling">Horizontal Scaling<a class="headerlink" href="#horizontal-scaling" title="Permanent link">&para;</a></h3>
<p><strong>Stateless Design:</strong>
- No in-memory session state
- All state in SQLite/Redis
- Each instance independent</p>
<p><strong>Load Balancing:</strong>
<div class="highlight"><pre><span></span><code>Load Balancer
    │
    ├─→ API Instance 1 (Worker Pool)
    │
    ├─→ API Instance 2 (Worker Pool)
    │
    └─→ API Instance 3 (Worker Pool)
         │
         └─→ Shared SQLite/Redis
</code></pre></div></p>
<p><strong>Considerations:</strong>
- SQLite → PostgreSQL for high concurrency
- Redis for distributed caching
- Shared file system for budgets.db</p>
<h3 id="vertical-scaling">Vertical Scaling<a class="headerlink" href="#vertical-scaling" title="Permanent link">&para;</a></h3>
<p><strong>Increase Workers:</strong>
<div class="highlight"><pre><span></span><code><span class="c1"># More workers = more concurrent Claude CLI processes</span>
<span class="n">worker_pool</span> <span class="o">=</span> <span class="n">WorkerPool</span><span class="p">(</span><span class="n">max_workers</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
</code></pre></div></p>
<p><strong>Resource Requirements:</strong>
- <strong>Memory:</strong> ~500MB per worker
- <strong>CPU:</strong> 1 core per 5 workers
- <strong>Disk:</strong> Minimal (temp files cleaned up)</p>
<h2 id="security">Security<a class="headerlink" href="#security" title="Permanent link">&para;</a></h2>
<h3 id="threat-model">Threat Model<a class="headerlink" href="#threat-model" title="Permanent link">&para;</a></h3>
<p><strong>Threats:</strong>
1. <strong>Unauthorized access</strong> → API key authentication
2. <strong>Budget abuse</strong> → Per-project limits
3. <strong>Injection attacks</strong> → Input sanitization
4. <strong>DoS</strong> → Rate limiting</p>
<p><strong>Mitigations:</strong>
- API key middleware (future)
- Budget enforcement (implemented)
- Pydantic validation (implemented)
- Rate limiting (optional, via Redis)</p>
<h3 id="data-privacy">Data Privacy<a class="headerlink" href="#data-privacy" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>No persistent prompts:</strong> Temp files deleted after completion</li>
<li><strong>Encrypted transport:</strong> HTTPS in production</li>
<li><strong>Access logs:</strong> Minimal logging, no prompt content</li>
</ul>
<h2 id="performance">Performance<a class="headerlink" href="#performance" title="Permanent link">&para;</a></h2>
<h3 id="latency-breakdown">Latency Breakdown<a class="headerlink" href="#latency-breakdown" title="Permanent link">&para;</a></h3>
<p>Typical request (Sonnet, 100-token prompt):</p>
<table>
<thead>
<tr>
<th>Component</th>
<th>Time</th>
<th>%</th>
</tr>
</thead>
<tbody>
<tr>
<td>API routing</td>
<td>5ms</td>
<td>1%</td>
</tr>
<tr>
<td>Budget check</td>
<td>10ms</td>
<td>2%</td>
</tr>
<tr>
<td>Queue wait</td>
<td>0-5s</td>
<td>0-50%</td>
</tr>
<tr>
<td>Claude CLI startup</td>
<td>500ms</td>
<td>10%</td>
</tr>
<tr>
<td>Model inference</td>
<td>2-3s</td>
<td>30-40%</td>
</tr>
<tr>
<td>JSON parsing</td>
<td>10ms</td>
<td>2%</td>
</tr>
<tr>
<td>Response formatting</td>
<td>5ms</td>
<td>1%</td>
</tr>
<tr>
<td><strong>Total</strong></td>
<td><strong>3-8s</strong></td>
<td><strong>100%</strong></td>
</tr>
</tbody>
</table>
<p><strong>Bottlenecks:</strong>
- Claude CLI startup time
- Worker pool size (queue wait)
- Model inference time</p>
<p><strong>Optimizations:</strong>
- Increase <code>max_workers</code> to reduce queue time
- Use Haiku for simple tasks (faster inference)
- Redis caching for repeated prompts</p>
<h3 id="throughput">Throughput<a class="headerlink" href="#throughput" title="Permanent link">&para;</a></h3>
<p><strong>Single instance (5 workers):</strong>
- Haiku: ~30 requests/minute
- Sonnet: ~15 requests/minute
- Opus: ~5 requests/minute</p>
<p><strong>Scaled (3 instances, 5 workers each):</strong>
- 3x throughput
- Shared budget tracking
- Independent worker pools</p>
<h2 id="error-handling">Error Handling<a class="headerlink" href="#error-handling" title="Permanent link">&para;</a></h2>
<h3 id="error-propagation">Error Propagation<a class="headerlink" href="#error-propagation" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>Claude CLI Process Error
  │
  ▼
Worker Pool (catch exception)
  │
  │ Mark task as FAILED
  │ Store error message
  ▼
API Router (check status)
  │
  │ If FAILED → HTTPException(500)
  ▼
Client (receives error response)
  │
  │ { detail: &quot;Task failed: ...&quot; }
</code></pre></div>
<h3 id="retry-strategy">Retry Strategy<a class="headerlink" href="#retry-strategy" title="Permanent link">&para;</a></h3>
<p><strong>Client-side retries:</strong>
- Automatic in <code>ClaudeClient</code> (max 3 retries)
- Exponential backoff
- Only retry on 500+ errors</p>
<p><strong>Server-side:</strong>
- No automatic retries (client's responsibility)
- Idempotent operations (budget checks)</p>
<h2 id="testing">Testing<a class="headerlink" href="#testing" title="Permanent link">&para;</a></h2>
<h3 id="test-coverage">Test Coverage<a class="headerlink" href="#test-coverage" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Component</th>
<th>Test File</th>
<th>Coverage</th>
</tr>
</thead>
<tbody>
<tr>
<td>Worker Pool</td>
<td><code>test_worker_pool.py</code></td>
<td>90%</td>
</tr>
<tr>
<td>Model Router</td>
<td><code>test_model_router.py</code></td>
<td>95%</td>
</tr>
<tr>
<td>Budget Manager</td>
<td><code>test_budget_manager.py</code></td>
<td>85%</td>
</tr>
<tr>
<td>Token Tracker</td>
<td><code>test_token_tracker.py</code></td>
<td>95%</td>
</tr>
<tr>
<td>API</td>
<td><code>test_api.py</code></td>
<td>80%</td>
</tr>
</tbody>
</table>
<h3 id="integration-tests">Integration Tests<a class="headerlink" href="#integration-tests" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># tests/test_api.py</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_end_to_end_completion</span><span class="p">():</span>
    <span class="c1"># Submit request → Wait → Check response</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s2">&quot;/v1/chat/completions&quot;</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span>
    <span class="k">assert</span> <span class="s2">&quot;content&quot;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
</code></pre></div>
<h2 id="future-enhancements">Future Enhancements<a class="headerlink" href="#future-enhancements" title="Permanent link">&para;</a></h2>
<ol>
<li><strong>WebSocket streaming</strong> - Real-time response streaming</li>
<li><strong>Multi-tenant isolation</strong> - Database per tenant</li>
<li><strong>Advanced caching</strong> - Semantic similarity caching</li>
<li><strong>Request queuing</strong> - Redis-based distributed queue</li>
<li><strong>Metrics dashboard</strong> - Grafana/Prometheus integration</li>
<li><strong>A/B testing</strong> - Model comparison framework</li>
</ol>
<h2 id="diagrams">Diagrams<a class="headerlink" href="#diagrams" title="Permanent link">&para;</a></h2>
<p>See also:
- Component interaction diagram (above)
- Data flow diagrams (above)
- Deployment architecture (DEPLOYMENT.md)</p>









  




                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2026 Anthropic
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        
<div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/anthropics/claude-code-api" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://twitter.com/anthropic" target="_blank" rel="noopener" title="twitter.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M459.4 151.7c.3 4.5.3 9.1.3 13.6 0 138.7-105.6 298.6-298.6 298.6-59.5 0-114.7-17.2-161.1-47.1 8.4 1 16.6 1.3 25.3 1.3 49.1 0 94.2-16.6 130.3-44.8-46.1-1-84.8-31.2-98.1-72.8 6.5 1 13 1.6 19.8 1.6 9.4 0 18.8-1.3 27.6-3.6-48.1-9.7-84.1-52-84.1-103v-1.3c14 7.8 30.2 12.7 47.4 13.3-28.3-18.8-46.8-51-46.8-87.4 0-19.5 5.2-37.4 14.3-53C87.4 130.8 165 172.4 252.1 176.9c-1.6-7.8-2.6-15.9-2.6-24C249.5 95.1 296.3 48 354.4 48c30.2 0 57.5 12.7 76.7 33.1 23.7-4.5 46.5-13.3 66.6-25.3-7.8 24.4-24.4 44.8-46.1 57.8 21.1-2.3 41.6-8.1 60.4-16.2-14.3 20.8-32.2 39.3-52.6 54.3"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "..", "features": ["search.suggest", "search.highlight", "content.code.copy", "content.code.select", "navigation.tabs", "navigation.top", "navigation.footer", "toc.follow"], "search": "../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.79ae519e.min.js"></script>
      
        <script src="../js/extra.js"></script>
      
    
  </body>
</html>