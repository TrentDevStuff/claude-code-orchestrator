---
created: 2026-01-31T10:17:13Z
type: plan
effort: EFFORT-CLI
project: claude-code-api-service
status: draft
---

# CLI Implementation Plan

## Executive Summary

Create a comprehensive `claude-api` CLI tool that makes service management intuitive for both humans and Claude Code agents. The CLI will wrap existing service functionality with rich, well-formatted commands optimized for quick operations and debugging.

---

## Design Philosophy

**From Claude Code's Perspective:**

When helping a user manage this service, I need to:
1. **Check status quickly** - Is it running? Are dependencies up?
2. **Create/manage API keys** - User wants to test → I need to generate a key
3. **Monitor health** - User reports issues → I need to see what's failing
4. **View logs** - Debugging errors → I need recent logs with context
5. **Test endpoints** - Verify functionality → I need simple test commands
6. **Track usage** - User asks "how much am I using?" → I need cost breakdown
7. **Manage workers** - Performance issues → I need worker pool visibility
8. **Validate config** - Setup issues → I need to verify dependencies, ports, agents

**Design Principles:**
- Commands should be **self-explanatory** (clear names, good help text)
- Output should be **parseable** (JSON option) and **readable** (tables, colors)
- Operations should be **fast** (<2s for most commands)
- Errors should be **actionable** ("Redis not running → Start with: redis-server")
- Batch operations should be **supported** (create multiple keys, test multiple endpoints)

---

## CLI Structure

```
claude-api
├── service          # Service lifecycle management
│   ├── start        # Start the API service
│   ├── stop         # Stop the API service
│   ├── restart      # Restart the API service
│   ├── status       # Service status (running, PID, uptime)
│   └── logs         # Tail service logs
│
├── health           # Health checks
│   ├── check        # Full health check (service + deps)
│   ├── deps         # Check dependencies (Redis, agents, skills)
│   └── ping         # Quick ping (is service responding?)
│
├── keys             # API key management
│   ├── create       # Create new API key
│   ├── list         # List all API keys
│   ├── revoke       # Revoke an API key
│   ├── permissions  # View/set key permissions
│   └── test         # Test if a key is valid
│
├── usage            # Usage analytics
│   ├── summary      # Overall usage summary
│   ├── by-project   # Usage by project
│   ├── by-model     # Usage by model
│   ├── costs        # Cost breakdown
│   └── export       # Export usage data (CSV/JSON)
│
├── workers          # Worker pool management
│   ├── status       # Worker pool status
│   ├── list         # List active workers
│   ├── clear-queue  # Clear pending tasks
│   └── kill         # Kill a specific worker
│
├── tasks            # Task management
│   ├── list         # List active tasks
│   ├── get          # Get task details
│   ├── cancel       # Cancel a running task
│   └── logs         # View task execution logs
│
├── budgets          # Budget management
│   ├── list         # List all project budgets
│   ├── set          # Set budget for a project
│   ├── usage        # Check budget usage
│   └── alerts       # View budget alerts
│
├── test             # Testing commands
│   ├── completion   # Test chat completion endpoint
│   ├── task         # Test agentic task endpoint
│   ├── agents       # Test agent discovery
│   ├── skills       # Test skill discovery
│   └── all          # Run all endpoint tests
│
├── config           # Configuration
│   ├── show         # Show current configuration
│   ├── validate     # Validate configuration
│   ├── port         # Check port configuration
│   └── env          # Show environment variables
│
└── audit            # Security & audit
    ├── events       # View security events
    ├── failed-auth  # View failed auth attempts
    └── export       # Export audit logs
```

---

## Command Specifications

### 1. Service Management (`claude-api service`)

#### `claude-api service start`

**Purpose:** Start the API service (if not running)

**Options:**
- `--port PORT` - Override default port
- `--background` - Run in background (detached)
- `--no-deps-check` - Skip dependency checks
- `--logs` - Tail logs after starting

**Output:**
```
✓ Dependencies verified (Redis: running)
✓ Port 8006 available
✓ Agent discovery: 25 agents found
✓ Skill discovery: 17 skills found
✓ Starting Claude Code API Service on port 8006...
✓ Service started (PID: 12345)
✓ Health check: OK (2 workers ready)

Service URL: http://localhost:8006
API Docs: http://localhost:8006/docs
```

**Use Case:** Claude Code helping user start service for testing

---

#### `claude-api service stop`

**Purpose:** Stop the running service

**Options:**
- `--force` - Force kill if graceful shutdown fails
- `--timeout SECONDS` - Shutdown timeout (default: 30)

**Output:**
```
✓ Found service (PID: 12345)
✓ Sending shutdown signal...
✓ Waiting for graceful shutdown...
✓ Service stopped successfully
```

---

#### `claude-api service status`

**Purpose:** Check if service is running and show details

**Options:**
- `--json` - Output as JSON

**Output:**
```
Service Status
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
Running:     ✓ Yes
PID:         12345
Port:        8006
Uptime:      2h 34m
Workers:     5/5 active
Queue:       0 pending
Memory:      234 MB
CPU:         12.3%

Dependencies
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
Redis:       ✓ Running (port 6379)
Agents:      ✓ 25 discovered
Skills:      ✓ 17 discovered
```

**Use Case:** Quick status check when helping user debug

---

#### `claude-api service logs`

**Purpose:** Tail service logs

**Options:**
- `--lines N` - Number of lines to show (default: 50)
- `--follow` - Follow logs (tail -f style)
- `--level LEVEL` - Filter by level (DEBUG, INFO, WARNING, ERROR)
- `--search PATTERN` - Search for pattern
- `--json` - Output as JSON

**Output:**
```
[2026-01-31 10:15:23] INFO  - Service started on port 8006
[2026-01-31 10:15:24] INFO  - Worker pool initialized (5 workers)
[2026-01-31 10:16:10] INFO  - API key validated: cc_7fae...
[2026-01-31 10:16:11] INFO  - Task started: 96cc8456-7fcc...
[2026-01-31 10:16:24] INFO  - Task completed: 96cc8456-7fcc... (cost: $0.00076)
```

**Use Case:** Debugging errors or monitoring activity

---

### 2. Health Checks (`claude-api health`)

#### `claude-api health check`

**Purpose:** Comprehensive health check

**Options:**
- `--json` - Output as JSON
- `--verbose` - Show detailed component status

**Output:**
```
Health Check Results
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
Overall:     ✓ Healthy

Components
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
API Service:     ✓ Responding (127ms)
Worker Pool:     ✓ 5/5 workers active
Redis:           ✓ Connected (ping: 2ms)
Budget Manager:  ✓ Operational
Auth Manager:    ✓ Operational
Agent Discovery: ✓ 25 agents found
Skill Discovery: ✓ 17 skills found
```

**Use Case:** Pre-flight check before user operations

---

#### `claude-api health deps`

**Purpose:** Check dependencies only

**Output:**
```
Dependency Status
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
Redis (required)
  Status:     ✓ Running
  Port:       6379
  Ping:       2ms
  Memory:     45.2 MB

Claude CLI (required)
  Installed:  ✓ Yes
  Version:    1.2.3
  Path:       /usr/local/bin/claude

Agents (required)
  Location:   ~/.claude/agents/
  Count:      25 discovered

Skills (required)
  Location:   ~/.claude/skills/
  Count:      17 discovered
```

**Use Case:** Diagnosing startup failures

---

### 3. API Key Management (`claude-api keys`)

#### `claude-api keys create`

**Purpose:** Create new API key

**Options:**
- `--project-id ID` - Project identifier
- `--profile PROFILE` - Permission profile (free, pro, enterprise)
- `--rate-limit N` - Requests per minute (default: 60)
- `--name NAME` - Friendly name for key
- `--output json|text|env` - Output format

**Output:**
```
✓ API key created successfully

Key:         cc_a1b2c3d4e5f6...
Project:     my-project
Profile:     enterprise
Rate Limit:  100 req/min
Created:     2026-01-31 10:17:14

Permissions:
  Tools:     All (Read, Write, Bash, Grep, Glob, etc.)
  Agents:    All 25 agents
  Skills:    All 17 skills
  Max Cost:  $10.00/task

Add to .env:
  CLAUDE_API_KEY=cc_a1b2c3d4e5f6...
```

**Use Case:** User wants to test API → I create key for them

---

#### `claude-api keys list`

**Purpose:** List all API keys

**Options:**
- `--project-id ID` - Filter by project
- `--active-only` - Show only active keys
- `--json` - Output as JSON

**Output:**
```
API Keys
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
Key                 Project          Profile      Rate Limit  Created
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
cc_7fae7a64...      test-project     enterprise   100/min     2026-01-30
cc_abc123de...      my-app           pro          60/min      2026-01-29
cc_def456gh...      demo             free         20/min      2026-01-28
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

Total: 3 keys
```

**Use Case:** Checking existing keys before creating new one

---

#### `claude-api keys permissions <key>`

**Purpose:** View/set permissions for a key

**Options:**
- `--set-profile PROFILE` - Change profile
- `--add-tool TOOL` - Add allowed tool
- `--remove-tool TOOL` - Remove allowed tool
- `--add-agent AGENT` - Add allowed agent
- `--max-cost COST` - Set max cost per task

**Output:**
```
Permissions for cc_7fae7a64...
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
Profile:     enterprise
Max Cost:    $10.00/task

Allowed Tools: (all)
  Read, Write, Edit, Bash, Grep, Glob, WebSearch, WebFetch

Allowed Agents: (all 25)
  company-workflow-analyst, system-orchestrator, ...

Allowed Skills: (all 17)
  semantic-text-matcher, entity-mapper, ...
```

---

### 4. Usage Analytics (`claude-api usage`)

#### `claude-api usage summary`

**Purpose:** Overall usage summary

**Options:**
- `--period today|week|month|all` - Time period
- `--json` - Output as JSON

**Output:**
```
Usage Summary (Last 7 Days)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
Total Requests:  1,234
Successful:      1,198 (97.1%)
Failed:          36 (2.9%)

Token Usage:     2,456,789 tokens
  Input:         1,234,567 (50.3%)
  Output:        1,222,222 (49.7%)

Cost:            $12.34
  Haiku:         $2.45 (19.9%) - 856 requests
  Sonnet:        $8.76 (71.0%) - 356 requests
  Opus:          $1.13 (9.1%) - 22 requests

Avg Duration:    4.2s
P95 Latency:     12.8s
```

**Use Case:** User asks "how much am I using?"

---

#### `claude-api usage by-project`

**Purpose:** Usage breakdown by project

**Output:**
```
Usage by Project (Last 7 Days)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
Project           Requests  Tokens      Cost     Avg Duration
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
my-app            856       1,234,567   $6.78    3.2s
test-project      234       876,543     $4.32    5.1s
demo              144       345,679     $1.24    2.8s
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
Total             1,234     2,456,789   $12.34   4.2s
```

---

### 5. Worker Pool (`claude-api workers`)

#### `claude-api workers status`

**Purpose:** Worker pool status

**Output:**
```
Worker Pool Status
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
Max Workers:     5
Active:          3/5
Idle:            2/5
Queue:           2 pending
Total Executed:  1,234 tasks

Active Workers:
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
Worker  Task ID               Model   Duration  Status
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
1       96cc8456-7fcc...      haiku   12s       running
2       a3f4b7c8-9d1e...      sonnet  45s       running
3       c7e8f9a0-1b2c...      haiku   5s        running
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

**Use Case:** Diagnosing performance issues

---

### 6. Tasks (`claude-api tasks`)

#### `claude-api tasks list`

**Purpose:** List active/recent tasks

**Options:**
- `--status STATUS` - Filter by status (pending, running, completed, failed)
- `--limit N` - Number of tasks to show
- `--json` - Output as JSON

**Output:**
```
Recent Tasks
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
Task ID               Status      Model   Duration  Cost      Started
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
96cc8456-7fcc...      completed   haiku   12.8s     $0.00076  10:16:11
a3f4b7c8-9d1e...      running     sonnet  45.2s     -         10:15:30
c7e8f9a0-1b2c...      failed      haiku   8.1s      $0.00042  10:14:15
d9f0a1b2-3c4d...      completed   sonnet  23.4s     $0.00234  10:12:05
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

---

#### `claude-api tasks get <task_id>`

**Purpose:** Get detailed task information

**Output:**
```
Task Details: 96cc8456-7fcc-41a5-8898-ff9d25d33685
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
Status:      completed
Model:       haiku
Duration:    12.83s
Cost:        $0.00076
Started:     2026-01-31 10:16:11
Completed:   2026-01-31 10:16:24

Description:
  List the first 5 Python files in the src/ directory and show their sizes

Allowed Tools:
  Bash, Glob

Result:
  ## Summary

  Here are the first 5 Python files in the src/ directory with their sizes:

  1. **model_router.py** - 1.5K
  2. **budget_manager.py** - 9.2K
  3. **cache.py** - 8.2K
  4. **token_tracker.py** - 4.8K
  5. **auth.py** - 10K

Usage:
  Input tokens:    22
  Output tokens:   603
  Total tokens:    625
```

**Use Case:** Debugging task failures or reviewing results

---

### 7. Testing (`claude-api test`)

#### `claude-api test completion`

**Purpose:** Quick test of chat completion endpoint

**Options:**
- `--model MODEL` - Model to test (haiku, sonnet, opus)
- `--prompt TEXT` - Custom prompt (default: "Hello!")
- `--key KEY` - API key to use (default: test-key)

**Output:**
```
Testing Chat Completion Endpoint
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
Request:
  POST /v1/chat/completions
  Model: haiku
  Prompt: "Hello!"

✓ Response received (1.2s)
✓ Status: 200 OK
✓ Content: "Hello! How can I help you today?"
✓ Tokens: 22 input, 15 output
✓ Cost: $0.00002
```

**Use Case:** Quick sanity check after deployment

---

#### `claude-api test task`

**Purpose:** Test agentic task endpoint

**Options:**
- `--description TEXT` - Task description
- `--tools TOOL1,TOOL2` - Allowed tools
- `--key KEY` - API key to use

**Output:**
```
Testing Agentic Task Endpoint
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
Request:
  POST /v1/task
  Description: "List Python files in src/"
  Tools: [Bash, Glob]

✓ Task created (task_id: 96cc8456-7fcc...)
✓ Executing... (12.8s)
✓ Status: completed
✓ Result: Found 5 Python files
✓ Cost: $0.00076
```

---

#### `claude-api test agents`

**Purpose:** Test agent discovery

**Output:**
```
Testing Agent Discovery
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
✓ Scanning ~/.claude/agents/
✓ Found 25 agents
✓ Parsing metadata...
✓ All agents valid

Sample agents:
  • company-workflow-analyst (sonnet)
  • system-orchestrator (sonnet)
  • document-processor (haiku)
  • accessibility-auditor (sonnet)
  • workflow-sync-agent (sonnet)

✓ Agent discovery working correctly
```

---

#### `claude-api test all`

**Purpose:** Run all endpoint tests

**Output:**
```
Running All Endpoint Tests
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
✓ GET /health (127ms)
✓ GET /v1/capabilities (234ms)
✓ POST /v1/chat/completions (1.2s)
✓ POST /v1/task (12.8s)
✓ POST /v1/batch (3.4s)
✓ GET /v1/usage (89ms)
✗ WebSocket /v1/stream (connection refused)

Results: 6/7 passed (85.7%)
```

---

### 8. Configuration (`claude-api config`)

#### `claude-api config show`

**Purpose:** Show current configuration

**Output:**
```
Configuration
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
Service:
  Port:            8006
  Host:            0.0.0.0
  Redis URL:       redis://localhost:6379/0
  Max Workers:     5

Paths:
  Service Dir:     /Users/trent/claude-code-api-service
  Claude Dir:      /Users/trent/.claude
  Agents:          /Users/trent/.claude/agents/ (25 found)
  Skills:          /Users/trent/.claude/skills/ (17 found)

Budget:
  Default Limit:   1,000,000 tokens/month
  Alert Threshold: 80%

Models:
  Default:         auto (intelligent routing)
  Available:       haiku, sonnet, opus
```

---

#### `claude-api config validate`

**Purpose:** Validate configuration

**Output:**
```
Configuration Validation
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
✓ Port 8006 available
✓ Redis connection successful
✓ Claude CLI installed
✓ Agents directory exists (25 agents)
✓ Skills directory exists (17 skills)
✓ .env file valid
✓ Database initialized
✗ Redis persistence disabled (warning)

Result: Valid with 1 warning
```

---

### 9. Audit Logs (`claude-api audit`)

#### `claude-api audit events`

**Purpose:** View security events

**Options:**
- `--severity LEVEL` - Filter by severity
- `--limit N` - Number of events
- `--type TYPE` - Event type filter

**Output:**
```
Security Events (Last 24 Hours)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
Timestamp            Severity  Type              Details
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
2026-01-31 10:16:11  INFO      auth_success      API key: cc_7fae...
2026-01-31 09:45:23  WARNING   rate_limit        Project: my-app (98/100)
2026-01-31 08:12:34  ERROR     invalid_key       Attempted key: cc_invalid...
2026-01-31 07:23:45  INFO      permission_check  Tool: Write (allowed)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

Total: 234 events (2 errors, 12 warnings)
```

---

## Implementation Plan

### Phase 1: Foundation (Day 1 - Morning)

**Files to Create:**
- `cli/claude_api.py` - Main CLI entry point
- `cli/__init__.py`
- `cli/utils.py` - Shared utilities (formatting, API calls)
- `cli/config.py` - Configuration loading
- `setup.py` - Package setup with CLI entry point

**Dependencies:**
```
typer>=0.9.0           # Modern CLI framework
rich>=13.0.0           # Beautiful terminal output
requests>=2.31.0       # HTTP client
pydantic>=2.5.0        # Data validation
python-dotenv>=1.0.0   # Environment loading
```

**Tasks:**
1. Set up Typer CLI framework
2. Create base command structure
3. Implement config loading (auto-detect service location)
4. Add Rich formatting helpers (tables, progress bars, colors)
5. Create API client wrapper (shared HTTP calls)

**Acceptance:**
- `claude-api --help` works
- Config auto-detection works
- Basic formatting helpers work

---

### Phase 2: Service Management (Day 1 - Afternoon)

**Commands to Implement:**
- `claude-api service start`
- `claude-api service stop`
- `claude-api service restart`
- `claude-api service status`
- `claude-api service logs`

**Tasks:**
1. Process management (start/stop/PID tracking)
2. Log tailing with filtering
3. Dependency checks (Redis, Claude CLI)
4. Health checks on startup
5. Graceful shutdown handling

**Acceptance:**
- Can start/stop service reliably
- Status shows accurate information
- Logs are readable and filterable

---

### Phase 3: API Keys & Health (Day 1 - Evening)

**Commands to Implement:**
- `claude-api keys create/list/revoke/permissions/test`
- `claude-api health check/deps/ping`

**Tasks:**
1. Wrap AuthManager for key operations
2. Wrap PermissionManager for permission operations
3. Implement health check logic
4. Add dependency verification
5. Format output beautifully

**Acceptance:**
- Can create/manage API keys
- Health checks show accurate status
- Dependency issues clearly reported

---

### Phase 4: Usage & Workers (Day 2 - Morning)

**Commands to Implement:**
- `claude-api usage summary/by-project/by-model/costs/export`
- `claude-api workers status/list/clear-queue/kill`

**Tasks:**
1. Query budget manager for usage data
2. Format analytics as tables/charts
3. Export functionality (CSV/JSON)
4. Worker pool inspection
5. Queue management

**Acceptance:**
- Usage analytics are accurate
- Worker status shows real-time data
- Export formats work correctly

---

### Phase 5: Tasks & Testing (Day 2 - Afternoon)

**Commands to Implement:**
- `claude-api tasks list/get/cancel/logs`
- `claude-api test completion/task/agents/skills/all`

**Tasks:**
1. Task listing and filtering
2. Detailed task inspection
3. Quick endpoint tests
4. Agent/skill discovery tests
5. Batch testing

**Acceptance:**
- Can inspect active tasks
- Tests provide clear pass/fail
- Agent/skill discovery verified

---

### Phase 6: Config, Budgets, Audit (Day 2 - Evening)

**Commands to Implement:**
- `claude-api config show/validate/port/env`
- `claude-api budgets list/set/usage/alerts`
- `claude-api audit events/failed-auth/export`

**Tasks:**
1. Configuration display and validation
2. Budget management wrapper
3. Audit log querying
4. Security event filtering

**Acceptance:**
- Config validation catches issues
- Budget commands work correctly
- Audit logs are queryable

---

### Phase 7: Polish & Documentation (Day 3)

**Tasks:**
1. Comprehensive help text for all commands
2. Error handling and suggestions
3. Progress bars for long operations
4. README with examples
5. Integration guide for Claude Code agents
6. Shell completion (bash/zsh)

**Documentation Files:**
- `cli/README.md` - CLI usage guide
- `cli/EXAMPLES.md` - Common workflows
- `cli/INTEGRATION.md` - Claude Code integration

**Acceptance:**
- All commands have clear help text
- Errors suggest solutions
- Documentation is complete

---

## Technical Details

### CLI Framework: Typer

**Why Typer:**
- Built on Click (mature, stable)
- Type hints for auto-validation
- Beautiful help text generation
- Rich integration for formatting
- Async support for non-blocking operations

**Example Structure:**
```python
import typer
from rich.console import Console
from rich.table import Table

app = typer.Typer(help="Claude Code API Service CLI")
console = Console()

@app.command()
def status():
    """Check service status"""
    # Implementation
    table = Table(title="Service Status")
    table.add_column("Component", style="cyan")
    table.add_column("Status", style="green")
    # ...
    console.print(table)
```

### Configuration Discovery

**Auto-detection logic:**
1. Check `CLAUDE_API_SERVICE_DIR` environment variable
2. Check current directory for `main.py`
3. Check `~/claude-code-api-service/`
4. Prompt user if not found

**Config file (`~/.claude-api/config.yaml`):**
```yaml
service:
  directory: /Users/trent/claude-code-api-service
  port: 8006
  auto_start: false

cli:
  default_output: table  # table, json, text
  color: auto            # auto, always, never
  verbose: false
```

### API Client Wrapper

**Shared HTTP client:**
```python
class APIClient:
    def __init__(self, base_url: str = "http://localhost:8006"):
        self.base_url = base_url
        self.session = requests.Session()

    def get(self, endpoint: str, **kwargs):
        # Error handling, retries, formatting
        pass

    def post(self, endpoint: str, **kwargs):
        pass
```

### Output Formatting

**Three modes:**
1. **Table** (default) - Rich tables for humans
2. **JSON** - Parseable output for Claude Code
3. **Text** - Simple text for piping

**Example:**
```python
def format_output(data, format="table"):
    if format == "json":
        return json.dumps(data, indent=2)
    elif format == "table":
        table = Table()
        # Build table...
        return table
    else:
        return str(data)
```

---

## Success Metrics

**Usability:**
- ✅ Claude Code can invoke any command successfully
- ✅ All commands complete in <2s (except long-running operations)
- ✅ Error messages suggest solutions
- ✅ Help text is comprehensive

**Coverage:**
- ✅ All major service functions accessible via CLI
- ✅ All monitoring capabilities available
- ✅ All management operations supported

**Quality:**
- ✅ 80%+ code coverage from tests
- ✅ Type hints throughout
- ✅ Comprehensive documentation
- ✅ Shell completion works

---

## Integration with Claude Code

**Example Workflows:**

**1. User wants to test API:**
```
Claude Code:
  1. claude-api health check  # Verify service ready
  2. claude-api keys create --project-id test --profile enterprise
  3. Export API_KEY from output
  4. claude-api test completion --key $API_KEY
```

**2. User reports errors:**
```
Claude Code:
  1. claude-api service status  # Check if running
  2. claude-api service logs --level ERROR --lines 50
  3. claude-api health deps  # Check dependencies
  4. Report findings with suggested fixes
```

**3. User asks about usage:**
```
Claude Code:
  1. claude-api usage summary --period week
  2. claude-api usage by-project
  3. Format and present to user
```

**4. Performance issues:**
```
Claude Code:
  1. claude-api workers status  # Check worker saturation
  2. claude-api tasks list --status running
  3. claude-api usage costs  # Check if expensive model overuse
  4. Suggest optimizations
```

---

## Installation

**After implementation:**

```bash
# Development
cd /Users/trent/claude-code-api-service
pip install -e ".[cli]"

# Production
pip install claude-code-api-service[cli]

# Verify
claude-api --version
claude-api --help
```

**Shell completion:**
```bash
# Bash
claude-api --install-completion bash

# Zsh
claude-api --install-completion zsh
```

---

## Future Enhancements

**V2 Features (post-initial release):**
- Interactive mode (TUI with textual)
- Real-time monitoring dashboard
- Alerting rules management
- Backup/restore commands
- Migration commands
- Plugin system for custom commands
- Remote service management (not just localhost)

---

## Summary

This CLI will make the Claude Code API Service dramatically easier to manage, monitor, and debug. By designing from Claude Code's perspective, we ensure the commands provide exactly the information and operations needed to help users effectively.

**Key Benefits:**
1. **Quick status checks** - See service health in seconds
2. **Easy API key management** - Generate test keys instantly
3. **Rich monitoring** - Usage, costs, performance metrics
4. **Fast debugging** - Logs, worker status, task inspection
5. **Comprehensive testing** - Validate all endpoints quickly
6. **Beautiful output** - Tables, colors, progress bars
7. **Claude-friendly** - JSON output for parsing, clear error messages

**Ready to build!**
